= 系统设计
septnn <septnn@163.com>
v1.0, 2020-08-03

== 分片

. 根据数据容量评估分配数，设置过小，后续无法水平扩展；单分片数据量太大，也容易导致数据分片耗时严重
. 分片数设置如果太大，会导致资源浪费，性能降低；同时也会影响搜索结果打分和搜索准确性
. 磁盘，推荐 SSD，JVM最大 Xmx 不要超过30G
. 副本分片至少设置为1。主分片，单个存储不要超过 30 GB，按照这个你推算出分片数，进行设定
. 集群中磁盘快满的时候，你再增加机器，确实可能导致新建的索引全部分配到新节点上去的可能性。最终导致数据分配不均。所以要记得监控集群，到70%就需要考虑删除数据或是增加节点
. 可以设置最大分片数缓解这个问题。
. 分片的尺寸如果过大，确实也没有快速恢复的办法，所以尽量保证分片的size在40G以下

== profile

query 提供 profile:true，开启query分析。

把query差分成为底层lucene请求。

== 内存

. jvm.options主要是进行内存相关配置，官方建议分配给es的内存不要超出系统内存的50%，预留一半给Lucene，因为Lucene会缓存segment数据提升检索性能；内存配置不要超过32g，如果你的服务器内存没有远远超过64g，那么不建议将es的jvm内存设置为32g，因为超过32g后每个jvm对象指针的长度会翻倍，导致内存与cpu的开销增大
.

== 集群

. 独立的master节点，不存储数据, 数量不少于2
. 数据节点(Data Node)
. 查询节点(Query Node)，起到负载均衡的作用