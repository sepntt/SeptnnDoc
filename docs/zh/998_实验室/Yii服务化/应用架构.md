# 应用架构

## TODO LIST

- 服务和应用划分
  - 服务层=数据+服务（service + model）
  - 应用层=接口+业务（controller + console）
- 目录结构
- 规范
  - 命名规范
  - 接口规范
  - models 数据库接口
    - 凡是需要拼接orm，放入model，如果只有一个findOne可以直接调用。
    - 只允许service调用
  - controllers 业务接口
    - 业务处理，拼接服务接口，实现业务，分业务线，例如摇奖单独文件夹，m站单独文件夹
    - 程序事务处理(事务使用需要评审)
  - services 服务接口
    - 可任意替换
    - 处理异常，超时处理，日志记录
    - 处理本服务业务，关键判断，mysql事务处理，
    - 提供带有事务性方法，并且提供commit和rollback方法
    - 跨模块service不允许相互调用。同模块可以相互调用
- 设计模式
  - 函数调用/抽象、接口、集成、多态、注册
    - 高扩展、高可用、健壮性强
  - 容灾、回滚、异常、超时
  - 依赖注入
- 应用层
  - 版本
  - 监控
- 服务层
  - 版本
  - 注册
  - 监控
- 代码
  - 注释/phpdoc
  - 强制类型
- 测试
  - 单元测试
- vendor/jwd、php扩展、所需软件
- 进程管理
- 日志
  - 记录进程号
- 高并发
- 配置文件
  - 运维管理，提供常量

## 目录结构

- config
  - prod
    - app.php
    - params.php
    - log.php
  - dev
    - app.php
    - params.php
    - log.php
  - test
    - app.php
    - params.php
    - log.php
  - web.php
  - console.php
  - params.php
- console
  - ConsoleController.php
  - order
    - OrderController.php
- controllers
  - BaseController.php
  - ali
    - mini
      - OrderController.php
  - wx
    - mini
  - vip
    - OrderController.php
  - bi
    - OrderController.php
- swooleControllers
  - user
    - TagController.php
- models
  - BaseModel.php
  - orderOnline
    - OrderChannleWebModel.php
  - vip
    - BannerInfoModel.php
- services
  - BaseService.php
  - order
    - OrderService.php
  - goods
    - GoodsService.php
  - user
  - wx
    - pay
    - mini
    - wx
  - ali
    - pay
    - mini
    - ali
  - activity
  - fengniao
    - dispatch
  - meituan
    - dispatch
    - order
- views
- web
  - index.php
- .dev
